#!/usr/bin/env bash
# vim: ft=bash
# Â© Copyright 2021 Konstantin Gredeskoul
# Part of BASHMATIC framework.

set +e

((DEBUG + __debug + debug)) && BASHMATIC_DEBUG=1

function source_if_exists() {
  local errors=0
  for file in "$@"; do
    if [[ -s "${file}" ]]; then
      ((BASHMATIC_DEBUG)) && printf "[debug] â€”â€”> ${bldgrn}%-60.60s${clr}" "${file}"
      source "${file}"
      local code=$?

      if ((code)); then
        if ((BASHMATIC_DEBUG)); then
          printf " (exit code: ${code} [ ðŸ’£ ])\n"
          code=$((code + 1))
        else
          code=$((code + 1))
          echo "WARNING: sourced file ${file} returned non-zero code ${code}" >&2
        fi
      else
        if ((BASHMATIC_DEBUG)); then
          printf " (${bldgrn}[  âœ”ï¸Ž ]${clr})\n"
        fi
      fi
    else
      echo "WARNING: sourced file ${file} does not exist" >&2
    fi
  done
  return ${code}
}
