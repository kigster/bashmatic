#!/usr/bin/env bash
# vim: ft=bash
# Â© Copyright 2021 Konstantin Gredeskoul
# Part of BASHMATIC framework.

set +e

function is-debug() {
  [[ $((DEBUG + BASHMATIC_DEBUG + BASHMATIC_PATH_DEBUG)) -gt 0 ]] 
}

is-debug && BASHMATIC_DEBUG=1
is-debug || unset BASHMATIC_DEBUG

function source_if_exists() {
  local errors=0
  local files="${#@}"
  for file in "$@"; do
    if [[ -s "${file}" ]]; then
      is-debug && printf "[debug] â€”â€”> ${bldgrn}%-60.60s${clr}" "${file}"
      source "${file}"
      local code=$?

      if ((code)); then
        if is-debug; then
          printf " (exit code: ${code} [ ðŸ’£ ])\n"
          code=$((code + 1))
          errors=$((errors + 1))
        else
          code=$((code + 1))
          echo "WARNING: sourced file ${file} returned non-zero code ${code}" >&2
        fi
      else
        if is-debug; then
          printf " (${bldgrn}[  âœ”ï¸Ž ]${clr})\n"
        fi
      fi
    else
      echo "WARNING: sourced file ${file} does not exist" >&2
    fi
  done

  is-debug && echo "source_if_exists: attempted to source ${files} files, ${errors} returned errors."
  
  return ${code}
}

